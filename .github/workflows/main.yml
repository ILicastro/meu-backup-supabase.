# Nome do Workflow
name: Backup Banco de Dados Supabase

# Permite que você rode este workflow manualmente pela aba Actions
on:
  workflow_dispatch:

jobs:
  backup:
    runs-on: ubuntu-latest

    steps:
      # Instala o cliente do PostgreSQL (que inclui o pg_dump)
      - name: Install PostgreSQL client
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client

      # Executa o pg_dump usando PGPASSWORD para a senha (método mais robusto)
      - name: Run pg_dump
        run: |
          export PGPASSWORD="${{ secrets.SUPABASE_DB_PASSWORD }}"
          pg_dump "postgresql://postgres.bocshdnwowoobaaxylir@aws-1-sa-east-1.pooler.supabase.com:5432/postgres" > backup_barbearia.sql
        
      # Disponibiliza o arquivo gerado para download
      - name: Upload backup artifact
        uses: actions/upload-artifact@v4
        with:
          name: backup-sql
          path: backup_barbearia.sql
