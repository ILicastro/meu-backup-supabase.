# Nome do Workflow
name: Backup Banco de Dados Supabase

# Permite que você rode este workflow manualmente pela aba Actions
on:
  workflow_dispatch:

jobs F:
  backup:
    runs-on: ubuntu-latest

    steps:
      # Usa uma Action especialista para instalar o PostgreSQL v17.
      # Esta é a forma mais robusta e garantida.
      - name: Set up PostgreSQL client v17
        uses: postgresql-actions/setup-postgresql@v1
        with:
          version: '17'

      # Executa o pg_dump. Agora ele terá a versão 17.
      - name: Run pg_dump
        run: |
          export PGPASSWORD="${{ secrets.SUPABASE_DB_PASSWORD }}"
          pg_dump "postgresql://postgres.bocshdnwowoobaaxylir@aws-1-sa-east-1.pooler.supabase.com:5432/postgres" > backup_barbearia.sql
        
      # Disponibiliza o arquivo gerado para download
      - name: Upload backup artifact
        uses: actions/upload-artifact@v4
        with:
          name: backup-sql
          path: backup_barbearia.sql
